<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unity Automobile - Bengkel Rekanan Asuransi di Medan</title>
    <meta name="description" content="Unity Automobile adalah bengkel rekanan asuransi terbaik di Medan sejak 2003. Menyediakan layanan body repair, cat oven, servis, dan klaim asuransi.">
    <meta name="keywords" content="bengkel mobil medan, bengkel asuransi medan, unity automobile, body repair medan, cat oven medan, service mobil medan">
    
    <link rel="icon" type="image/png" href="/unity.png">

    <!-- Library Eksternal -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

    <!-- Kode CSS digabung di sini -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            scroll-behavior: smooth;
        }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .primary-blue { color: #0A74DA; }
        .bg-primary-blue { background-color: #0A74DA; }
        .accent-dark { color: #111827; }
        .bg-accent-dark { background-color: #111827; }
        
        .hero-section {
            /* height: 100vh; */
        }
        #hero-carousel .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        #hero-carousel .carousel-slide.active {
            opacity: 1;
        }
        #hero-dots .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #hero-dots .dot.active {
            background-color: white;
        }

        .testimonial-card, .service-card {
            background: white;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e5e7eb;
        }
        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .btn-loading {
            position: relative;
            color: transparent !important;
            pointer-events: none;
        }
        .btn-loading::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 20px;
            height: 20px;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .gallery-slide {
            transition: opacity 1s ease-in-out;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .skeleton {
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            50% { opacity: .5; }
        }
        .cta-pulse {
            animation: pulse-cta 2.5s infinite ease-in-out;
        }
        @keyframes pulse-cta {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .service-card .bg-gradient-to-br i {
            transition: transform 0.3s ease;
        }
        .service-card:hover .bg-gradient-to-br i {
            transform: scale(1.1) rotate(-5deg);
        }
    </style>
</head>

<body class="text-gray-800 antialiased">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-lg sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="#home" class="text-2xl font-poppins font-bold accent-dark">Unity <span class="primary-blue">Automobile</span></a>
                <nav class="hidden md:flex space-x-8 text-sm font-semibold text-gray-600">
                    <a href="#layanan" class="hover:primary-blue transition-colors duration-300">Layanan</a>
                    <a href="#asuransi" class="hover:primary-blue transition-colors duration-300">Rekanan</a>
                    <a href="#galeri" class="hover:primary-blue transition-colors duration-300">Galeri</a>
                    <a href="#testimoni" class="hover:primary-blue transition-colors duration-300">Testimoni</a>
                    <a href="#lokasi" class="hover:primary-blue transition-colors duration-300">Lokasi</a>
                </nav>
                <a href="#kontak-form"
                    class="hidden md:inline-block bg-primary-blue text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-opacity-90 transition-all duration-300 shadow-lg shadow-blue-500/20">Hubungi
                    Kami</a>
                <button id="mobile-menu-button" class="md:hidden">
                    <i data-feather="menu"></i>
                </button>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4">
                <a href="#layanan" class="nav-link block py-2 px-4 text-sm hover:bg-gray-100 rounded">Layanan</a>
                <a href="#asuransi" class="nav-link block py-2 px-4 text-sm hover:bg-gray-100 rounded">Rekanan</a>
                <a href="#galeri" class="nav-link block py-2 px-4 text-sm hover:bg-gray-100 rounded">Galeri</a>
                <a href="#testimoni" class="nav-link block py-2 px-4 text-sm hover:bg-gray-100 rounded">Testimoni</a>
                <a href="#lokasi" class="nav-link block py-2 px-4 text-sm hover:bg-gray-100 rounded">Lokasi</a>
                <a href="#kontak-form"
                    class="nav-link block mt-2 w-full text-center bg-primary-blue text-white px-5 py-2 rounded-lg font-semibold hover:bg-opacity-90 transition-all duration-300">Hubungi
                    Kami</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="home" class="relative hero-section h-[70vh] text-white flex items-center justify-center">
            <!-- Carousel container -->
            <div id="hero-carousel" class="absolute inset-0 w-full h-full z-10"></div>
            <div class="absolute inset-0 bg-black/60 z-20"></div>
            <div class="relative container mx-auto px-6 text-center z-30" data-aos="fade-in">
                <h1 id="profile-company-name-hero" class="text-4xl sm:text-5xl md:text-6xl font-poppins font-bold leading-tight mb-4">UNITY AUTOMOBILE</h1>
                <p id="profile-tagline" class="text-lg md:text-xl text-gray-300 mb-8 max-w-2xl mx-auto">Bengkel Rekanan Asuransi Terbaik di Medan</p>
                <div class="flex justify-center items-center flex-wrap gap-4">
                    <a href="#kontak-form"
                        class="bg-primary-blue text-white px-8 py-3 rounded-lg font-bold hover:bg-opacity-90 transition-transform duration-300 transform hover:scale-105 shadow-xl">
                        <i data-feather="send" class="inline-block -mt-1 mr-2"></i>Kirim Pertanyaan
                    </a>
                    <a href="#layanan"
                        class="border-2 border-white text-white px-8 py-3 rounded-lg font-bold hover:bg-white hover:text-accent-dark transition-all duration-300 transform hover:scale-105">
                        Lihat Layanan Kami
                    </a>
                </div>
            </div>
            <!-- Carousel controls -->
            <button id="hero-prev" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/20 p-2 rounded-full hover:bg-white/40 transition z-40">
                <i data-feather="chevron-left" class="text-white"></i>
            </button>
            <button id="hero-next" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/20 p-2 rounded-full hover:bg-white/40 transition z-40">
                <i data-feather="chevron-right" class="text-white"></i>
            </button>
            <!-- Carousel dots -->
            <div id="hero-dots" class="absolute bottom-8 left-1/2 -translate-x-1/2 flex space-x-2 z-40"></div>
        </section>

        <!-- Tentang Kami -->
        <section id="tentang" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-16" data-aos="fade-up">
                    <div class="lg:w-1/2">
                        <img src="gambar2.jpeg" alt="Tim Bengkel Unity Automobile" class="rounded-lg shadow-2xl w-full"
                            onerror="this.onerror=null; this.src='https://placehold.co/600x450/1E1E1E/FFFFFF?text=Unity+Automobile';">
                    </div>
                    <div class="lg:w-1/2">
                        <h2 id="profile-company-name-about" class="text-3xl sm:text-4xl font-poppins font-bold accent-dark">Tentang Unity Automobile</h2>
                        <p class="text-gray-500 mt-2 mb-6">Profesional, Terpercaya, dan Berpengalaman Sejak 2003.</p>
                        <p id="profile-about-us" class="text-gray-700 mb-4 leading-relaxed">
                            Memuat deskripsi...
                        </p>
                        <h3 class="text-xl font-poppins font-semibold accent-dark mb-4 mt-8">Mengapa Memilih Kami?</h3>
                        <ul class="space-y-4 text-gray-700">
                            <li class="flex items-start"><i data-feather="check-circle"
                                    class="text-green-500 mr-3 mt-1 flex-shrink-0"></i><span><strong>Kepuasan
                                        Pelanggan:</strong> Prioritas utama kami adalah memberikan hasil yang memuaskan
                                    dan layanan yang ramah.</span></li>
                            <li class="flex items-start"><i data-feather="check-circle"
                                    class="text-green-500 mr-3 mt-1 flex-shrink-0"></i><span><strong>Suku Cadang
                                        Berkualitas:</strong> Kami hanya menggunakan suku cadang asli dan berkualitas
                                    tinggi untuk setiap perbaikan.</span></li>
                            <li class="flex items-start"><i data-feather="check-circle"
                                    class="text-green-500 mr-3 mt-1 flex-shrink-0"></i><span><strong>Proses
                                        Transparan:</strong> Kami memberikan estimasi biaya yang jelas dan penjelasan
                                    detail sebelum pengerjaan dimulai.</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Stats Section -->
        <section id="stats" class="py-16 bg-gray-800 text-white">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 text-center" data-aos="fade-up">
                    <div>
                        <h3 class="text-4xl font-poppins font-bold primary-blue">1,500+</h3>
                        <p class="mt-2 font-semibold">Klien Puas</p>
                    </div>
                    <div>
                        <h3 class="text-4xl font-poppins font-bold primary-blue">20+</h3>
                        <p class="mt-2 font-semibold">Tahun Pengalaman</p>
                    </div>
                    <div>
                        <h3 class="text-4xl font-poppins font-bold primary-blue" id="insurance-count">10+</h3>
                        <p class="mt-2 font-semibold">Asuransi Rekanan</p>
                    </div>
                    <div>
                        <h3 class="text-4xl font-poppins font-bold primary-blue" id="visitor-count">0</h3>
                        <p class="mt-2 font-semibold">Pengunjung Website</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Layanan Kami -->
        <section id="layanan" class="py-16 md:py-24 bg-gray-50">
            <div class="container mx-auto px-6" data-aos="fade-up">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-poppins font-bold accent-dark">Layanan Profesional Kami</h2>
                    <p class="text-gray-600 mt-2 max-w-2xl mx-auto">Kami menyediakan solusi lengkap untuk semua
                        kebutuhan kendaraan Anda, dari perbaikan ringan hingga restorasi penuh.</p>
                </div>
                <div id="services-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Kartu layanan akan dimuat di sini oleh JavaScript -->
                </div>
            </div>
        </section>

        <!-- Asuransi Rekanan -->
        <section id="asuransi" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-6" data-aos="fade-up">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-poppins font-bold accent-dark">Rekanan Asuransi Kami</h2>
                    <p class="text-gray-600 mt-2">Kami bekerja sama dengan berbagai perusahaan asuransi terkemuka.</p>
                </div>
                <div id="insurance-list"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8 items-center">
                    <!-- Logos will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Testimoni -->
        <section id="testimoni" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-6" data-aos="fade-up">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-poppins font-bold accent-dark">Testimoni Pelanggan</h2>
                    <p class="text-gray-600 mt-2">Apa kata mereka tentang layanan kami.</p>
                </div>
                <div class="relative">
                    <div id="testimonial-container" class="flex overflow-x-auto scroll-smooth snap-x snap-mandatory gap-8 mb-12 pb-4">
                        <!-- Testimonials will be loaded here -->
                    </div>
                    <button id="testimonial-prev" class="absolute top-1/2 left-0 transform -translate-y-1/2 bg-white/80 backdrop-blur-sm rounded-full p-2 shadow-md hover:bg-gray-100 transition z-10 hidden md:block">&lt;</button>
                    <button id="testimonial-next" class="absolute top-1/2 right-0 transform -translate-y-1/2 bg-white/80 backdrop-blur-sm rounded-full p-2 shadow-md hover:bg-gray-100 transition z-10 hidden md:block">&gt;</button>
                </div>

                <div class="text-center">
                    <button id="show-testimonial-form-btn"
                        class="bg-primary-blue text-white px-8 py-3 rounded-lg font-bold hover:bg-opacity-90 transition-all duration-300">
                        Tambahkan Testimoni Anda
                    </button>
                </div>
                <div id="testimonial-form-container"
                    class="hidden max-w-2xl mx-auto bg-gray-50 p-8 rounded-lg shadow-inner mt-12 transition-all">
                    <h3 class="text-2xl font-poppins font-bold text-center accent-dark mb-6">Bagikan Pengalaman Anda</h3>
                    <form id="testimonial-form">
                        <div class="mb-4">
                            <label for="nama" class="block text-gray-700 font-semibold mb-2">Nama Anda</label>
                            <input type="text" id="nama" name="nama"
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Rating</label>
                            <div id="star-rating"
                                class="flex items-center space-x-1 text-3xl text-gray-300 cursor-pointer">
                                <span data-value="1">★</span><span data-value="2">★</span><span
                                    data-value="3">★</span><span data-value="4">★</span><span data-value="5">★</span>
                            </div>
                            <input type="hidden" id="rating-value" name="rating" required>
                        </div>
                        <div class="mb-6">
                            <label for="pesan" class="block text-gray-700 font-semibold mb-2">Testimoni Anda</label>
                            <textarea id="pesan" name="pesan" rows="4"
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required></textarea>
                        </div>
                        <button type="submit" id="submit-testimonial-btn"
                            class="w-full bg-green-500 text-white py-3 px-6 rounded-lg font-bold hover:bg-green-600 transition-all duration-300">
                            Kirim Testimoni
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Galeri Section -->
        <section id="galeri" class="py-16 md:py-24 bg-gray-50">
            <div class="container mx-auto px-6" data-aos="fade-up">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-poppins font-bold accent-dark">Galeri Kami</h2>
                    <p class="text-gray-600 mt-2 max-w-2xl mx-auto">Dokumentasi pekerjaan dan hasil berkualitas dari Unity Automobile.</p>
                </div>
                <div class="relative max-w-4xl mx-auto">
                    <div id="gallery-carousel-container" class="relative h-80 md:h-[500px] w-full overflow-hidden rounded-lg shadow-2xl bg-gray-200 flex items-center justify-center">
                        <p>Memuat galeri...</p>
                    </div>
                    <button id="gallery-prev" class="absolute top-1/2 left-0 transform -translate-y-1/2 sm:-translate-x-1/2 bg-white/80 backdrop-blur-sm rounded-full p-3 shadow-md hover:bg-white transition z-10">
                        <i data-feather="chevron-left"></i>
                    </button>
                    <button id="gallery-next" class="absolute top-1/2 right-0 transform -translate-y-1/2 sm:translate-x-1/2 bg-white/80 backdrop-blur-sm rounded-full p-3 shadow-md hover:bg-white transition z-10">
                        <i data-feather="chevron-right"></i>
                    </button>
                    <div id="gallery-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2"></div>
                </div>
            </div>
        </section>

        <!-- Lokasi -->
        <section id="lokasi" class="py-16 md:py-24">
            <div class="container mx-auto px-6" data-aos="fade-up">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-poppins font-bold accent-dark">Kunjungi Kami</h2>
                    <p id="profile-address-map" class="text-gray-600 mt-2">Memuat alamat...</p>
                </div>
                <div id="map-container" class="aspect-w-16 aspect-h-9 rounded-lg shadow-xl overflow-hidden">
                    <p class="text-center p-8">Memuat peta...</p>
                </div>
                <div class="text-center mt-8">
                    <button id="share-location-btn"
                        class="bg-green-500 text-white px-8 py-3 rounded-lg font-bold hover:bg-green-600 transition-all duration-300">
                        <i data-feather="share-2" class="inline-block mr-2"></i>Bagikan Lokasi
                    </button>
                </div>
            </div>
        </section>

        <!-- Kontak WhatsApp Form -->
        <section id="kontak-form" class="py-16 md:py-24 bg-accent-dark text-white">
            <div class="container mx-auto px-6 max-w-2xl text-center" data-aos="fade-up">
                <h2 class="text-3xl sm:text-4xl font-poppins font-bold">Punya Pertanyaan?</h2>
                <p class="text-gray-300 mt-2 mb-8 mx-auto">Hubungi kami melalui WhatsApp untuk konsultasi cepat atau
                    penjadwalan layanan. Isi form di bawah ini.</p>
                <div class="bg-white rounded-lg shadow-xl p-8 text-gray-800">
                    <form id="wa-form">
                        <div class="mb-4">
                            <label for="wa-nama" class="block text-gray-700 font-semibold mb-2 text-left">Nama</label>
                            <input type="text" id="wa-nama"
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-primary-blue"
                                required>
                        </div>
                        <div class="mb-4">
                            <label for="wa-no" class="block text-gray-700 font-semibold mb-2 text-left">Nomor
                                WhatsApp</label>
                            <input type="tel" id="wa-no"
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-primary-blue"
                                placeholder="Contoh: 08123456789" required>
                        </div>
                        <div class="mb-6">
                            <label for="wa-pesan" class="block text-gray-700 font-semibold mb-2 text-left">Pesan
                                Singkat</label>
                            <textarea id="wa-pesan" rows="3"
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:border-primary-blue"
                                placeholder="Contoh: Saya ingin bertanya tentang body repair." required></textarea>
                        </div>
                        <button type="submit" id="send-wa-btn"
                            class="w-full bg-green-500 text-white py-3 px-6 rounded-lg font-bold hover:bg-green-600 transition-all duration-300 flex items-center justify-center">
                            <i data-feather="message-circle" class="mr-2"></i> Kirim ke WhatsApp
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-12">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 id="footer-logo" class='text-lg font-poppins font-bold text-white mb-4'>UNITY AUTOMOBILE</h3>
                    <p class="text-sm">Bengkel rekanan asuransi terpercaya di Medan, menyediakan layanan berkualitas
                        dengan teknisi berpengalaman dan peralatan modern.</p>
                </div>
                <div>
                    <h3 class="text-lg font-poppins font-bold text-white mb-4">Informasi Kontak</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-start"><i data-feather="map-pin"
                                class="w-4 h-4 mr-3 mt-1 flex-shrink-0"></i><span id="footer-address">Memuat...</span></li>
                        <li class="flex items-start"><i data-feather="phone"
                                class="w-4 h-4 mr-3 mt-1 flex-shrink-0"></i><span id="footer-phone">Memuat...</span></li>
                        <li class="flex items-start"><i data-feather="mail"
                                class="w-4 h-4 mr-3 mt-1 flex-shrink-0"></i><span id="footer-email">Memuat...</span></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-poppins font-bold text-white mb-4">Jam Operasional</h3>
                    <ul class="space-y-2 text-sm">
                        <li id="footer-weekdays">Memuat...</li>
                        <li id="footer-weekend">Memuat...</li>
                    </ul>
                </div>
            </div>
            <div
                class="mt-8 border-t border-gray-800 pt-8 flex flex-col sm:flex-row justify-between items-center text-sm">
                <p>&copy; <span id="current-year"></span> <span id="footer-company-name">Unity Automobile</span>. All Rights Reserved.</p>
                </p>
            </div>
        </div>
    </footer>

    <!-- Service Detail Modal -->
    <div id="service-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-full overflow-y-auto modal-content scale-95">
            <div class="p-8">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div id="service-modal-icon" class="bg-gradient-to-br from-blue-500 to-blue-600 inline-flex p-3 rounded-full text-white mr-4"></div>
                        <h3 id="service-modal-title" class="text-2xl font-poppins font-bold accent-dark"></h3>
                    </div>
                    <button id="service-modal-close" class="p-1 hover:bg-gray-200 rounded-full">
                        <i data-feather="x"></i>
                    </button>
                </div>
                
                <div id="service-modal-body" class="prose max-w-none text-gray-700">
                    <div class="mb-6">
                        <h4 class="font-bold text-lg text-gray-800">Deskripsi</h4>
                        <p id="service-modal-short-desc"></p>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg text-gray-800">Detail Layanan</h4>
                        <div id="service-modal-detailed-desc" class="whitespace-pre-wrap"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Image Gallery Modal -->
    <div id="gallery-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-full flex flex-col modal-content scale-95">
            <div class="p-4 flex justify-between items-center border-b">
                <h3 id="gallery-modal-title" class="text-xl font-poppins font-bold accent-dark"></h3>
                <button id="gallery-modal-close" class="p-1 hover:bg-gray-200 rounded-full">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div class="p-4 md:p-8 flex-grow overflow-y-auto text-center">
                <img id="gallery-modal-image" src="" alt="Gambar Galeri" class="max-h-[60vh] w-auto mx-auto rounded-md mb-4">
                <p id="gallery-modal-description" class="text-gray-700 text-left"></p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
      </script>
      <script defer src="/_vercel/insights/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const SUPABASE_URL = 'https://fbuwyproxqmkuwncyxmf.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZidXd5cHJveHFta3V3bmN5eG1mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3ODIxMjUsImV4cCI6MjA2NDM1ODEyNX0.VnWPO81M9Fjf7T_syejephC65B93pqA9QXKzRUa4_ho';

            function initApp() {
                if (SUPABASE_URL.includes('ganti-dengan-url-supabase-anda')) {
                    document.body.innerHTML = `<div style="font-family: sans-serif; background-color: #ffcccc; color: #a80000; text-align: center; padding: 40px; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;"><h1 style="font-size: 2em; margin-bottom: 20px;">Kesalahan Konfigurasi</h1><p style="font-size: 1.2em;">Website belum terhubung ke database.</p><p style="margin-top: 10px;">Harap ganti placeholder <strong>SUPABASE_URL</strong> dan <strong>SUPABASE_ANON_KEY</strong> di dalam kode.</p></div>`;
                    return;
                }
                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                feather.replace();
                AOS.init({ duration: 800, once: true, offset: 50 });

                document.getElementById('current-year').textContent = new Date().getFullYear();
                const mobileMenu = document.getElementById('mobile-menu');
                document.getElementById('mobile-menu-button').addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => mobileMenu.classList.add('hidden'));
                });
                
                loadCompanyProfile(supabaseClient);
                loadServices(supabaseClient);
                incrementAndShowVisitorCount(supabaseClient);
                loadHeroBackground(supabaseClient);
                loadGallery(supabaseClient);
                loadInsurancePartners(supabaseClient);
                loadTestimonials(supabaseClient);
                setupTestimonialForm(supabaseClient);
                setupWhatsAppForm(supabaseClient);
                setupShareLocation();
                setupServiceModal();
                setupGalleryModal();
            }

            async function loadCompanyProfile(supabaseClient) {
                try {
                    const { data, error } = await supabaseClient.from('company_profile').select('*').eq('id', 1).single();
                    if (error) throw error;
                    if (!data) return;

                    window.WORKSHOP_WA_NUMBER = data.whatsapp_number;
                    document.getElementById('profile-company-name-hero').textContent = data.company_name.toUpperCase();
                    document.getElementById('profile-tagline').textContent = data.tagline;
                    document.getElementById('profile-company-name-about').textContent = `Tentang ${data.company_name}`;
                    document.getElementById('profile-about-us').textContent = data.about_us;
                    document.getElementById('profile-address-map').textContent = data.address;
                    document.getElementById('map-container').innerHTML = `<iframe src="${data.map_embed_url}" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;
                    document.getElementById('footer-logo').textContent = data.company_name.toUpperCase();
                    document.getElementById('footer-address').textContent = data.address;
                    document.getElementById('footer-phone').textContent = data.phone_number;
                    document.getElementById('footer-email').textContent = data.email;
                    document.getElementById('footer-weekdays').textContent = data.operating_hours_weekdays;
                    document.getElementById('footer-weekend').textContent = data.operating_hours_weekend;
                    document.getElementById('footer-company-name').textContent = data.company_name;
                    feather.replace();
                } catch (error) {
                    console.error("Gagal memuat profil usaha:", error.message);
                }
            }

            async function loadServices(supabaseClient) {
                const container = document.getElementById('services-container');
                container.innerHTML = '<p class="col-span-full text-center">Memuat layanan...</p>';
                try {
                    const { data, error } = await supabaseClient.from('services').select('*').order('created_at');
                    if (error) throw error;
                    container.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(service => {
                            const serviceCard = document.createElement('div');
                            serviceCard.className = 'bg-white p-8 rounded-lg service-card text-center cursor-pointer';
                            serviceCard.innerHTML = `
                                <div class="bg-gradient-to-br from-blue-500 to-blue-600 inline-flex p-4 rounded-full text-white mb-4 shadow-lg">
                                    <i data-feather="${service.icon_name || 'settings'}" class="h-8 w-8"></i>
                                </div>
                                <h3 class="text-xl font-bold accent-dark mb-2">${service.name}</h3>
                                <p class="text-gray-600">${service.description}</p>
                            `;
                            serviceCard.addEventListener('click', () => {
                                const modalIcon = document.getElementById('service-modal-icon');
                                modalIcon.innerHTML = '';
                                const icon = document.createElement('i');
                                icon.setAttribute('data-feather', service.icon_name || 'settings');
                                modalIcon.appendChild(icon);
                                feather.replace();

                                document.getElementById('service-modal-title').textContent = service.name;
                                document.getElementById('service-modal-short-desc').textContent = service.description;
                                document.getElementById('service-modal-detailed-desc').innerText = service.detailed_description || 'Tidak ada detail lebih lanjut.';
                                
                                const modal = document.getElementById('service-modal');
                                modal.classList.remove('hidden');
                                modal.classList.add('flex');
                            });
                            container.appendChild(serviceCard);
                        });
                        feather.replace();
                    } else {
                        container.innerHTML = '<p class="col-span-full text-center">Belum ada layanan yang tersedia.</p>';
                    }
                } catch (error) {
                    container.innerHTML = '<p class="col-span-full text-center text-red-500">Gagal memuat layanan.</p>';
                }
            }

            function setupServiceModal() {
                const modal = document.getElementById('service-modal');
                const closeButton = document.getElementById('service-modal-close');
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                    }
                });
                closeButton.addEventListener('click', () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                });
            }
            
            async function incrementAndShowVisitorCount(supabaseClient) {
                const el = document.getElementById('visitor-count');
                if (!el) return;
                try {
                    const { data, error } = await supabaseClient.rpc('increment_visitor_count');
                    if (error) throw error;
                    el.textContent = data;
                } catch (error) {
                    el.textContent = 'N/A';
                }
            }

            async function loadInsurancePartners(supabaseClient) {
                const listEl = document.getElementById('insurance-list');
                const countEl = document.getElementById('insurance-count');
                listEl.innerHTML = '<p class="col-span-full text-center">Memuat rekanan...</p>';
                try {
                    const { data, error, count } = await supabaseClient.from('insurance_partners').select('*', { count: 'exact' });
                    if(error) throw error;
                    if(countEl) countEl.textContent = `${count}+`;
                    listEl.innerHTML = '';
                    if(data.length > 0) data.forEach(p => listEl.innerHTML += `<div class="flex justify-center items-center transform transition-transform duration-300 hover:scale-110"><img src="${p.logo_url}" alt="${p.name}" class="h-12 md:h-16" onerror="this.style.display='none'"></div>`);
                    else listEl.innerHTML = '<p class="col-span-full text-center">Belum ada rekanan.</p>';
                } catch(error) {
                    listEl.innerHTML = '<p class="col-span-full text-center text-red-500">Gagal memuat rekanan.</p>';
                }
            }

            async function loadHeroBackground(supabaseClient) {
                try {
                    const { data, error } = await supabaseClient.from('gallery_images').select('image_url, before_image_url').order('created_at', { ascending: false }).limit(5);
                    
                    if (error) throw error;
                    if (!data || data.length === 0) return;

                    const carouselContainer = document.getElementById('hero-carousel');
                    const dotsContainer = document.getElementById('hero-dots');
                    const prevButton = document.getElementById('hero-prev');
                    const nextButton = document.getElementById('hero-next');
                    
                    carouselContainer.innerHTML = '';
                    dotsContainer.innerHTML = '';

                    let currentIndex = 0;
                    let intervalId;

                    const images = data.map(image => image.before_image_url || image.image_url).filter(Boolean);
                    
                    if (images.length === 0) return;

                    images.forEach((imageUrl, index) => {
                        const slide = document.createElement('div');
                        slide.className = 'carousel-slide';

                        // Using single quotes and escaping any single quotes in the URL for robustness
                        slide.style.backgroundImage = `url('${imageUrl.replace(/'/g, "'")}')`;
                        
                        if (index === 0) slide.classList.add('active');
                        carouselContainer.appendChild(slide);

                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        if (index === 0) dot.classList.add('active');
                        dot.addEventListener('click', () => {
                            goToSlide(index);
                            resetInterval();
                        });
                        dotsContainer.appendChild(dot);
                    });
                    
                    feather.replace();

                    const slides = document.querySelectorAll('#hero-carousel .carousel-slide');
                    const dots = document.querySelectorAll('#hero-dots .dot');

                    if (slides.length <= 1) {
                        if(prevButton) prevButton.style.display = 'none';
                        if(nextButton) nextButton.style.display = 'none';
                        if(dotsContainer) dotsContainer.style.display = 'none';
                        return;
                    }

                    function goToSlide(index) {
                        if (slides.length === 0) return;
                        if (slides[currentIndex]) slides[currentIndex].classList.remove('active');
                        if (dots[currentIndex]) dots[currentIndex].classList.remove('active');
                        
                        currentIndex = (index + slides.length) % slides.length;
                        
                        if (slides[currentIndex]) slides[currentIndex].classList.add('active');
                        if (dots[currentIndex]) dots[currentIndex].classList.add('active');
                    }

                    function nextSlide() {
                        if (slides.length === 0) return;
                        const newIndex = (currentIndex + 1) % slides.length;
                        goToSlide(newIndex);
                    }

                    function prevSlide() {
                        if (slides.length === 0) return;
                        const newIndex = (currentIndex - 1 + slides.length) % slides.length;
                        goToSlide(newIndex);
                    }
                    
                    function startInterval() {
                        clearInterval(intervalId);
                        intervalId = setInterval(nextSlide, 5000);
                    }

                    function resetInterval() {
                        clearInterval(intervalId);
                        startInterval();
                    }

                    prevButton.addEventListener('click', () => {
                        prevSlide();
                        resetInterval();
                    });
                    nextButton.addEventListener('click', () => {
                        nextSlide();
                        resetInterval();
                    });

                    startInterval();

                } catch (error) {
                    console.error('Gagal memuat gambar hero:', error.message);
                }
            }

            async function loadGallery(supabaseClient) {
                const container = document.getElementById('gallery-carousel-container');
                const dotsContainer = document.getElementById('gallery-dots');
                const prevBtn = document.getElementById('gallery-prev');
                const nextBtn = document.getElementById('gallery-next');

                if (!container || !dotsContainer || !prevBtn || !nextBtn) return;

                try {
                    const { data, error } = await supabaseClient
                        .from('gallery_images')
                        .select('image_url, before_image_url, after_image_url, title, description')
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    
                    if (!data || data.length === 0) {
                        container.innerHTML = '<p class="text-center text-gray-500">Belum ada gambar di galeri.</p>';
                        prevBtn.style.display = 'none';
                        nextBtn.style.display = 'none';
                        dotsContainer.style.display = 'none';
                        return;
                    }

                    const images = data.reduce((acc, img) => {
                        const common = { title: img.title, description: img.description };
                        if (img.image_url) acc.push({ url: img.image_url, ...common });
                        if (img.before_image_url) acc.push({ url: img.before_image_url, ...common, title: `${img.title || 'Gambar'} (Sebelum)` });
                        if (img.after_image_url) acc.push({ url: img.after_image_url, ...common, title: `${img.title || 'Gambar'} (Sesudah)` });
                        return acc;
                    }, []);

                    if (images.length === 0) {
                        container.innerHTML = '<p class="text-center text-gray-500">Tidak ada gambar yang valid untuk ditampilkan.</p>';
                        prevBtn.style.display = 'none';
                        nextBtn.style.display = 'none';
                        dotsContainer.style.display = 'none';
                        return;
                    }

                    container.innerHTML = '';
                    dotsContainer.innerHTML = '';
                    let currentIndex = 0;

                    images.forEach((imageData, index) => {
                        const slide = document.createElement('div');
                        slide.className = 'absolute w-full h-full transition-opacity duration-500 ease-in-out opacity-0 cursor-pointer pointer-events-none';
                        
                        if (index === 0) {
                            slide.classList.remove('opacity-0');
                            slide.classList.remove('pointer-events-none');
                        }
                        
                        const img = document.createElement('img');
                        img.src = imageData.url;
                        img.alt = imageData.title || `Galeri Unity Automobile ${index + 1}`;
                        img.className = 'w-full h-full object-cover';
                        img.loading = 'lazy';

                        slide.appendChild(img);

                        slide.addEventListener('click', () => {
                            openGalleryModal(imageData);
                        });

                        container.appendChild(slide);

                        const dot = document.createElement('button');
                        dot.className = 'w-3 h-3 rounded-full bg-white/60 hover:bg-white transition';
                        if (index === 0) {
                            dot.classList.add('!bg-white');
                        }
                        dot.addEventListener('click', () => goToGallerySlide(index));
                        dotsContainer.appendChild(dot);
                    });
                    
                    feather.replace();
                    const slides = container.children;
                    const dots = dotsContainer.children;

                    if (slides.length <= 1) {
                        prevBtn.style.display = 'none';
                        nextBtn.style.display = 'none';
                        dotsContainer.style.display = 'none';
                        return;
                    }

                    function goToGallerySlide(index) {
                        if (slides.length === 0) return;
                        
                        slides[currentIndex].classList.add('opacity-0');
                        slides[currentIndex].classList.add('pointer-events-none');
                        dots[currentIndex].classList.remove('!bg-white');
                        
                        currentIndex = (index + slides.length) % slides.length;
                        
                        slides[currentIndex].classList.remove('opacity-0');
                        slides[currentIndex].classList.remove('pointer-events-none');
                        dots[currentIndex].classList.add('!bg-white');
                    }

                    prevBtn.addEventListener('click', () => goToGallerySlide(currentIndex - 1));
                    nextBtn.addEventListener('click', () => goToGallerySlide(currentIndex + 1));

                } catch (error) {
                    console.error('Gagal memuat galeri:', error.message);
                    container.innerHTML = `<p class="text-center text-red-500">Gagal memuat galeri: ${error.message}</p>`;
                }
            }

            function openGalleryModal(imageData) {
                const modal = document.getElementById('gallery-modal');
                const modalTitle = document.getElementById('gallery-modal-title');
                const modalImage = document.getElementById('gallery-modal-image');
                const modalDescription = document.getElementById('gallery-modal-description');
                
                if (!modal || !modalTitle || !modalImage || !modalDescription) return;

                modalTitle.textContent = imageData.title || 'Detail Gambar';
                modalImage.src = imageData.url;
                modalDescription.textContent = imageData.description || 'Tidak ada deskripsi.';
                
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function setupGalleryModal() {
                const modal = document.getElementById('gallery-modal');
                const closeButton = document.getElementById('gallery-modal-close');
                if (!modal || !closeButton) return;

                closeButton.addEventListener('click', () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                    }
                });
            }
        
            async function loadTestimonials(supabaseClient) {
                const el = document.getElementById('testimonial-container');
                el.innerHTML = '<p class="text-center w-full">Memuat testimoni...</p>';
                try {
                    const { data, error } = await supabaseClient.from('testimonials').select('*').order('created_at', { ascending: false });
                    if (error) throw error;
                    el.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(t => {
                            const stars = '★'.repeat(t.rating) + '☆'.repeat(5 - t.rating);
                            el.innerHTML += `
                                <div class="snap-start flex-shrink-0 w-full sm:w-1/2 lg:w-1/3">
                                    <div class="bg-white p-6 rounded-lg testimonial-card h-full">
                                        <div class="flex items-center mb-4">
                                            <div class="w-12 h-12 rounded-full bg-primary-blue text-white flex items-center justify-center font-bold text-xl mr-4 shrink-0">${t.name.charAt(0).toUpperCase()}</div>
                                            <div>
                                                <h4 class="font-bold accent-dark">${t.name}</h4>
                                                <div class="text-yellow-400 text-lg">${stars}</div>
                                            </div>
                                        </div>
                                        <p class="text-gray-600 italic">"${t.message}"</p>
                                    </div>
                                </div>`;
                        });
                        setupTestimonialCarousel();
                    } else {
                        el.innerHTML = '<p class="text-center w-full">Jadilah yang pertama memberikan testimoni!</p>';
                        document.getElementById('testimonial-prev').style.display = 'none';
                        document.getElementById('testimonial-next').style.display = 'none';
                    }
                } catch (error) {
                    el.innerHTML = '<p class="text-center w-full text-red-500">Gagal memuat testimoni.</p>';
                }
            }

            function setupTestimonialCarousel() {
                const container = document.getElementById('testimonial-container');
                const prevBtn = document.getElementById('testimonial-prev');
                const nextBtn = document.getElementById('testimonial-next');
                if (!container || !prevBtn || !nextBtn) return;

                const scrollAmount = container.offsetWidth;

                nextBtn.addEventListener('click', () => {
                    container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                });

                prevBtn.addEventListener('click', () => {
                    container.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                });

                // Show/hide buttons based on scroll position
                const handleScrollButtons = () => {
                    prevBtn.style.display = container.scrollLeft > 0 ? 'block' : 'none';
                    nextBtn.style.display = container.scrollLeft < (container.scrollWidth - container.offsetWidth) ? 'block' : 'none';
                };

                container.addEventListener('scroll', handleScrollButtons);
                handleScrollButtons(); // Initial check
            }
            
            function setupTestimonialForm(supabaseClient) {
                const showBtn = document.getElementById('show-testimonial-form-btn');
                const formContainer = document.getElementById('testimonial-form-container');
                if(!showBtn || !formContainer) return;
                const form = document.getElementById('testimonial-form');
                const stars = document.querySelectorAll('#star-rating span');
                const ratingValueInput = document.getElementById('rating-value');
                const submitBtn = document.getElementById('submit-testimonial-btn');
                showBtn.addEventListener('click', () => {
                    formContainer.classList.remove('hidden');
                    formContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    showBtn.classList.add('hidden');
                });
                stars.forEach(star => star.addEventListener('click', () => {
                    const value = star.getAttribute('data-value');
                    ratingValueInput.value = value;
                    stars.forEach(s => {
                        s.classList.toggle('text-yellow-400', s.getAttribute('data-value') <= value);
                        s.classList.toggle('text-gray-300', s.getAttribute('data-value') > value);
                    });
                }));
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!ratingValueInput.value) { alert("Harap berikan rating bintang."); return; }
                    setLoading(submitBtn, true);
                    const { error } = await supabaseClient.from('testimonials').insert([{ name: form.nama.value, rating: form.rating.value, message: form.pesan.value }]);
                    setLoading(submitBtn, false);
                    if (error) { alert('Maaf, terjadi kesalahan.'); } 
                    else {
                        alert('Terima kasih! Testimoni Anda telah diterima.');
                        form.reset();
                        ratingValueInput.value = '';
                        stars.forEach(s => s.classList.replace('text-yellow-400', 'text-gray-300'));
                        formContainer.classList.add('hidden');
                        showBtn.classList.remove('hidden');
                        loadTestimonials(supabaseClient);
                    }
                });
            }

            function setupWhatsAppForm(supabaseClient) {
                const waForm = document.getElementById('wa-form');
                if(!waForm) return;
                const sendBtn = document.getElementById('send-wa-btn');
                waForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    setLoading(sendBtn, true);
                    const name = waForm['wa-nama'].value, phone = waForm['wa-no'].value, message = waForm['wa-pesan'].value;
                    try { await supabaseClient.from('contacts').insert([{ name, phone, message }]); } 
                    catch(error) { console.error('Error saving contact:', error.message); }
                    const waMessage = `Halo Unity Automobile,

Nama: *${name}*
No. WA: *${phone}*

Pesan:
${message}`;
                    const encodedMessage = encodeURIComponent(waMessage);
                    window.open(`https://api.whatsapp.com/send?phone=${window.WORKSHOP_WA_NUMBER || '6285372336699'}&text=${encodedMessage}`, '_blank');
                    setLoading(sendBtn, false);
                    waForm.reset();
                });
            }

            function setupShareLocation() {
                const shareBtn = document.getElementById('share-location-btn');
                if(!shareBtn) return;
                shareBtn.addEventListener('click', () => {
                    const locationUrl = 'https://maps.app.goo.gl/wQhCfhT1E3gXJqYV6'; 
                    const shareData = { title: 'Lokasi Unity Automobile', text: 'Kunjungi Unity Automobile di Medan.', url: locationUrl };
                    if (navigator.share) navigator.share(shareData).catch(console.error); 
                    else navigator.clipboard.writeText(locationUrl).then(() => alert('Lokasi disalin!'));
                });
            }
            
            function setLoading(button, isLoading) {
                button.classList.toggle('btn-loading', isLoading);
                button.disabled = isLoading;
            }

            initApp();
        });
    </script>
</body>

</html>